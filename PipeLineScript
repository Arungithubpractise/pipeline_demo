pipeline {
    agent any

    stages {
        stage('Checkout SCM') {
            steps {
                checkout scm
            }
        }
        stage('Checkout Code') {
            steps {
                git url: 'https://github.com/Arungithubpractise/pipeline_demo.git', branch: 'master'
            }
        }    
        stage('Unit Tests') {
            steps {
                sh 'pytest tests/unit_tests.py'
                junit(testResults: 'reports/unit_tests.xml')
            }
        }
        
        stage('Integration Tests') {
            steps {
                sh 'python tests/integration_tests.py'
                junit(testResults: 'reports/integration_tests.xml')
            }
        }
        
        stage('UI Tests (Optional)') {
            steps {
                sh 'selenium-tests.sh'
                allure(results: 'reports/allure-results') 
            }
        }
        
        stage('Smoke Tests') {
            steps {
                sh 'python tests/smoke_tests.py' 
            }
        }
        
        stage('Generate Test Reports') {
            steps {
                publishHtml(target: 'reports/test_report.html', alwaysLinkToLastBuild: true,  allowMissing: true)
            }
        }
    }
}
