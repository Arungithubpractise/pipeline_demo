pipeline {
    agent any
    
    stages {
        
        stage('CleanWorkSpace')
        {
            steps{
 bat '''
if exist PageObjectModel (
    rmdir /s /q PageObjectModel
)
'''


            }
        }
        stage('GitClone')
        {
            steps{
                dir('C:\\Project\\AutomationFramework\\PageObjectModel')
                {
                    git branch: "master", url: "https://github.com/MaximumAutomation/AllureNUnitIntegration.git" 
                }
            }
        }
        
        stage('DotNetClean') {
    steps {
        bat 'dotnet clean'
    }
}

        }
        stage('DotNetBuild')
        {
            steps{
                dotnetBuild project: 'C:\\Project\\AutomationFramework1\\PageObjectModel'
            }
        }
        stage('SettingsUpdate')
        {
            steps{
                script
                {
                    def filename = 'C:/Project/AutomationFramework/PageObjectModel/Configuration/configsetting.json'
                    def settings = readJSON file: filename
                    settings["PlatformVersion"] = 'iPhone 14'
                    settings['PlatformName'] = 'iOS'
                    writeJSON file: filename, json: settings
                }    
            }
            
        }
        stage('TestRun'){
            steps{
                dotnetTest project: 'C:\\Project\\AutomationFramework1\\PageObjectModel'
            }
        }
        
    }
}
